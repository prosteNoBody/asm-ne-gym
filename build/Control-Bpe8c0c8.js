const a=16.666666666666668;class d{constructor(t,e){this._entities=[],this._isActive=!1,this._updateTicks=0,this._lastFrameTimeMs=0,this._control=t,this._sharedState=this.initSharedState(),this._finishCallback=e}getCallbacks(){return{registerEntity:t=>this.registerEntity(t),destroyEntity:t=>this.destroyEntity(t),stopEngine:()=>this.stop()}}registerEntities(t){t.forEach(e=>{this.registerEntity(e)})}registerEntity(t){this._entities.push(t),t.registerCallbacks(this.getCallbacks())}destroyEntity(t){const e=this._entities.findIndex(i=>i.getId()===t);this._entities.splice(e,1)}render(){if(this._ctx){this._ctx.beginPath(),this.renderMap(this._ctx);for(let t=0;t<this._entities.length;t++)this._entities[t].render(this._ctx);this._ctx.fill()}}renderMap(t){t.clearRect(0,0,t.canvas.width,t.canvas.height)}updateGame(t,e){}updateState(){this._sharedState=this._control.updateState(this._sharedState)}updateEntities(){for(let t=0;t<this._entities.length;t++)this._entities[t].update(this._sharedState,this._updateTicks)}updateColissions(){for(let t=0;t<this._entities.length;t++)if(this._entities[t].isCollidable())for(let e=t+1;e<this._entities.length;e++){if(!this._entities[e].isCollidable())continue;const i=this._entities[t],s=this._entities[e],h=i.getPos(),o=i.getSize(),n=s.getPos(),l=s.getSize();(h.x<n.x?n.x-h.x<o.width:h.x-n.x<l.width)&&(h.y<n.y?n.y-h.y<o.height:h.y-n.y<l.height)&&(i.collide(this._sharedState,s),s.collide(this._sharedState,i))}}update(){this._updateTicks++,this.updateState(),this.updateGame(this._sharedState,this._updateTicks),this.updateEntities(),this.updateColissions()}beforeEnd(){this._finishCallback?.(this._sharedState),this._control.onmount()}loop(){for(;this._isActive;)this.update();this.beforeEnd()}setFrameBeforeRenderableLoop(t){this._lastFrameTimeMs=t,requestAnimationFrame(e=>this.renderableLoop(e))}renderableLoop(t){if(!this._isActive)return this.beforeEnd();let e=t-this._lastFrameTimeMs,i=!1;for(;e>=a;)i=!0,this.update(),this._lastFrameTimeMs+=a,e-=a;i&&this.render(),requestAnimationFrame(s=>this.renderableLoop(s))}mount(t){this._ctx=t,this._ctx||this.render()}run(){this._isActive=!0,this._ctx?requestAnimationFrame(t=>this.setFrameBeforeRenderableLoop(t)):this.loop()}stop(){this._isActive=!1}}class _{constructor(t,e,i){this._id=Math.floor(Math.random()*9999).toString(),this._size=t,this._pos=e,this._collisions=i}registerCallbacks(t){this._engineCallbacks=t}destroy(){this._engineCallbacks?.destroyEntity(this._id)}isCollidable(){return this._collisions}getId(){return this._id}getSize(){return this._size}getPos(){return this._pos}}class c{onmount(){}}export{d as C,c as a,_ as b};
