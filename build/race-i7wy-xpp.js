import{C as r,a as c,b as o}from"./Control-BNrD7OlY.js";class d extends c{constructor(){super(),this.handleKeydownEvent=this.handleKeydownEvent.bind(this),this.handleKeyupEvent=this.handleKeyupEvent.bind(this),this._controls={up:!1,right:!1,down:!1,left:!1}}handleKeyEvent(t,e){switch(t){case"w":this._controls.up=e;break;case"d":this._controls.right=e;break;case"s":this._controls.down=e;break;case"a":this._controls.left=e;break}}handleKeydownEvent(t){this.handleKeyEvent(t.key,!0)}handleKeyupEvent(t){this.handleKeyEvent(t.key,!1)}updateState(t){return t.controls={...this._controls},t}}class l extends o{constructor(t){super({width:20,height:20},t,!0),this.acc=0,this.vel=0,this.angle=Math.PI/2}render(t){t.fillStyle="blue",t.fillRect(this._pos.x,this._pos.y,this._size.width,this._size.height),t.fillStyle="red",t.fillRect(this._pos.x+this._size.width/2+Math.sin(this.angle)*(this._size.width/2)-2,this._pos.y+this._size.height/2+Math.cos(this.angle)*(this._size.height/2)-2,4,4)}static{this.MAX_SPEED=9}update(t,e){t.controls.down?this.acc=-.3:t.controls.up?this.acc=.3:this.acc=0,this.vel+=this.acc,this.vel<3?this.vel=3:this.vel>l.MAX_SPEED&&(this.vel=l.MAX_SPEED),t.controls.left&&(this.angle+=Math.PI/4*(.4/this.vel)),t.controls.right&&(this.angle-=Math.PI/4*(.4/this.vel)),this.angle%=Math.PI*2;const s=-2;t.score+=this.vel+s,this._pos.x+=this.vel*Math.sin(this.angle),this._pos.y+=this.vel*Math.cos(this.angle),this._pos.x<0&&(this._pos.x=0),this._pos.x+this._size.width>t.mapSize.width&&(this._pos.x=t.mapSize.width-this._size.width),this._pos.y<0&&(this._pos.y=0),this._pos.y+this._size.height>t.mapSize.height&&(this._pos.y=t.mapSize.height-this._size.height)}colide(t,e){e instanceof a&&(this.destroy(),this._engineCallbacks?.stopEngine())}}class a extends o{render(t){t.fillStyle="black",t.fillRect(this._pos.x,this._pos.y,this._size.width,this._size.height)}update(t,e){}colide(t,e){}}class _ extends r{constructor(t){const e=new d;super(e,i=>{t(i.score)});const s=new l({x:75,y:55});this.registerEntity(s);for(const i of[[0,0,35,900],[35,0,555,35],[555,35,35,110],[555,115,250,35],[800,0,35,150],[835,0,670,35],[35,525,200,35],[35,865,750,35],[1465,35,35,200],[1455,235,35,150],[785,840,150,35],[935,825,150,35],[1050,790,150,35],[1165,755,150,35],[1280,720,150,35],[1300,685,150,35],[1350,650,120,35],[1400,615,80,35],[1445,385,35,150],[1430,535,35,80],[140,130,260,35],[365,165,35,80],[365,245,660,35],[990,145,35,100],[990,110,360,35],[1330,145,35,70],[1300,215,35,70],[1270,285,35,70],[1270,285,35,100],[1240,385,35,100],[1155,485,100,35],[1080,520,100,35],[1e3,555,100,35],[930,590,100,35],[850,625,100,35],[680,660,200,35],[230,695,470,35],[430,350,35,345],[170,315,295,35],[170,165,35,150]]){const h=new a({width:i[2],height:i[3]},{x:i[0],y:i[1]},!0);this.registerEntity(h)}}renderMap(t){t.fillStyle="gray",t.fillRect(0,0,this._sharedState.mapSize.width,this._sharedState.mapSize.height)}getSize(){return this._sharedState.mapSize}initSharedState(){return{score:0,controls:{up:!1,down:!1,left:!1,right:!1},mapSize:{width:1500,height:900}}}}const f=(n,t)=>new Promise(e=>{const s=new _(i=>{e(i)});if(t){const i=s.getSize();t.width=i.width,t.height=i.height;const h=t.getContext("2d");h&&s.mount(h)}s.run()});export{f as default};
